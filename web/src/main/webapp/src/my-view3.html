<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="shared-styles.html">

<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">

<link rel="import" href="boton.html">

<dom-module id="my-view3">
    <template>
        <style include="shared-styles boton">
            :host {
                display: block;

                padding: 10px;
            }

            paper-dropdown-menu {
                width: 100%;
            }

            table {
                font-family: arial, sans-serif;
                border-collapse: collapse;
                width: 100%;
            }

            td, th {
                border: 1px solid #dddddd;
                text-align: left;
                padding: 8px;
            }

            tr:nth-child(even) {
                background-color: #dddddd;
            }

            .card {
                box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
            }
        </style>


        <!--
    EXEMPLE DE DADES
    Dades de la reserva
    Nom* JAUME Llinatges* TRIAS DNI 43080999V correu @* JO@TU.COM Telèfon* 620159620
    País* ESPANYA Hora d'arribada* 18:30H
    Data IN 01/11/16 Data OUT 02/11/16 PAX 10 NITS 1 HABITACIÓ SI
    Preu PAX/NIT ALLOTJAMENT = 14,00€
    Preu TOTAL allotjament = 140,00€
    EXTRES de la reserva
    AQUESTS SERVEIS EXTRES ES PAGUEN EN ARRIBAR AL REFUGI
    Dret a cuina = 14 persones (28,00€)
    Llençols = 2 llençolS (6,00€)
    Tavalloles = 2 tavalloles (2,00€)
    Preu TOTAL EXTRES = 36,00€
    Preu total RESERVA = 176,00€
    A PAGAR ARA = 70,00€
    A PAGAR EN ARRIBAR AL REFUGI = 106,00€
    Botó: PAGAR RESERVA
        -->
        <div class="container flex-center-justified">


            <form is="iron-form" id="form" method="post" action="/form/handler">
                <div class="card">
                    <h1>Dades de la reserva / Booking details</h1>
                    <h3>Tenim disponibilitat, pot reservar ara<br>
                        We have availability, you can reserve now</h3>
                    <br>
                    <h3>Ompli les seves dades / Fill your data</h3>

                    <div>{{data.resumen}}</div>
                    <paper-input name="name" label="Nom / Name *" required value="{{data.nombre}}" pattern="[A-Za-z]*"
                                 auto-validate="true"></paper-input>
                    <paper-input name="name" label="Llinatges / Surname *" required value="{{data.apellido}}"
                                 pattern="[A-Za-z]*" auto-validate="true"></paper-input>
                    <paper-input name="phone" label="Telèfon / Phone *" required value="{{data.phone}}" pattern="[0-9]*"
                                 error="Please only numbers" auto-validate="true"></paper-input>

                    <!--      <paper-input  name="surname" label="Cognom / Surname" required value="{{data.apellidos}}" ></paper-input>-->
                    <!--      <paper-input  name="dni" label="DNI / ID" required value="{{data.dni}}"></paper-input>-->
                    <paper-input name="email" label="Email" required value="{{data.email}}"
                                 pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$" error="Please only mail address"
                                 auto-validate="true"></paper-input>
                    <paper-input name="email" label="Repetir / repeat e-mail" required value="{{data.email2}}"
                                 pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$" error="Please only mail address"
                                 auto-validate="true"></paper-input>
                    <!--      <paper-input  name="country" label="País / Country" required value="{{data.pais}}"></paper-input>-->
                    <paper-dropdown-menu name="arrivalTime" label="Hora aproximada d' arribada / Estimated arival time"
                                         value="{{data.arrivalTime}}">
                        <paper-listbox class="dropdown-content">
                            <paper-item>Time</paper-item>
                            <paper-listbox class="dropdown-content">
                                <paper-item>8:00</paper-item>
                                <paper-item>9:00</paper-item>
                                <paper-item>10:00</paper-item>
                                <paper-item>11:00</paper-item>
                                <paper-item>12:00</paper-item>
                                <paper-item>13:00</paper-item>
                                <paper-item>14:00</paper-item>
                                <paper-item>15:00 "Please contact before arrive"</paper-item>
                                <paper-item>16:00</paper-item>
                                <paper-item>17:00</paper-item>
                                <paper-item>18:00</paper-item>
                                <paper-item>19:00</paper-item>
                                <paper-item>20:00</paper-item>
                                <paper-item>21:00</paper-item>
                                <paper-item>22:00</paper-item>
                                <paper-item>23:00</paper-item>
                            </paper-listbox>
                        </paper-listbox>
                    </paper-dropdown-menu>
                    <br/>
                    <paper-textarea label="Altres /Others" name="comments"
                                    value="{{data.comentarios}}"></paper-textarea>

                    <!--</div>-->
                    <!--<div class="card">-->

                    <br/>
                    <paper-dropdown-menu name="usekitchen" label="Cuina / kitchen" value="{{data.cocinas}}">
                        <paper-listbox class="dropdown-content">
                            <paper-item>No use kitchen</paper-item>
                            <paper-listbox class="dropdown-content">
                                <paper-item>1</paper-item>
                                <paper-item>2</paper-item>
                                <paper-item>3</paper-item>
                                <paper-item>4</paper-item>
                                <paper-item>5</paper-item>
                                <paper-item>6</paper-item>
                                <paper-item>7</paper-item>
                                <paper-item>8</paper-item>
                                <paper-item>9</paper-item>
                                <paper-item>10</paper-item>
                                <paper-item>11</paper-item>
                                <paper-item>12</paper-item>
                                <paper-item>13</paper-item>
                                <paper-item>14</paper-item>
                                <paper-item>15</paper-item>
                                <paper-item>16</paper-item>
                            </paper-listbox>
                        </paper-listbox>
                    </paper-dropdown-menu>
                    <br/>
                    <paper-dropdown-menu name="bedsheets" label="Roba de llit /Bed sheets" value="{{data.sabanas}}">
                        <paper-listbox class="dropdown-content">
                            <paper-item>Bring sleeping bag</paper-item>
                            <paper-listbox class="dropdown-content">
                                <paper-item>1</paper-item>
                                <paper-item>2</paper-item>
                                <paper-item>3</paper-item>
                                <paper-item>4</paper-item>
                                <paper-item>5</paper-item>
                                <paper-item>6</paper-item>
                                <paper-item>7</paper-item>
                                <paper-item>8</paper-item>
                                <paper-item>9</paper-item>
                                <paper-item>10</paper-item>
                                <paper-item>11</paper-item>
                                <paper-item>12</paper-item>
                                <paper-item>13</paper-item>
                                <paper-item>14</paper-item>
                                <paper-item>15</paper-item>
                                <paper-item>16</paper-item>
                            </paper-listbox>
                        </paper-listbox>
                    </paper-dropdown-menu>
                    <br/>
                    <paper-dropdown-menu name="rentATent" label="Lloguer de tenda / Rent a Tent"
                                         value="{{data.rentATent}}">
                        <paper-listbox class="dropdown-content">
                            <paper-item>Rent a Tent</paper-item>
                            <paper-listbox class="dropdown-content">
                                <paper-item>1</paper-item>
                                <paper-item>2</paper-item>
                                <paper-item>3</paper-item>
                                <paper-item>4</paper-item>
                                <paper-item>5</paper-item>
                                <paper-item>6</paper-item>
                                <paper-item>7</paper-item>
                                <paper-item>8</paper-item>
                                <paper-item>9</paper-item>
                                <paper-item>10</paper-item>
                                <paper-item>11</paper-item>
                                <paper-item>12</paper-item>
                                <paper-item>13</paper-item>
                                <paper-item>14</paper-item>
                                <paper-item>15</paper-item>
                                <paper-item>16</paper-item>
                            </paper-listbox>
                        </paper-listbox>
                    </paper-dropdown-menu>
                    <h3>Es obligatori L'ús de Liencols o de sac de dormir / It is Obligatory to use deb sheets or
                        sleeping
                        bag</h3>
                    <br>
                    <hr>
                    <h3>Preu total RESERVA / Total price of booking </h3>
                    <h3> 30.00 €</h3>
                    <paper-button raised class="indigo">Pagar ara / Pay Now</paper-button>

                    <br/>
                    <h3>Pagar en efectiu / Rest of booking by cash</h3>
                    <h3> 60.00 €</h3>

                    <br>
                    <table>
                        <tr>
                            <td>Arribada /Check in</td>
                            <td>27/08/2017</td>
                        </tr>
                        <tr>
                            <td>Nits / Nights</td>
                            <td>2</td>
                        </tr>
                        <tr>
                            <td>Habitació / Bedroom</td>
                            <td>Yes</td>
                        </tr>
                    </table>
                    <br>
                    <table>
                        <tr>
                            <td>Sortida / Check Out</td>
                            <td>27/08/2017</td>
                        </tr>
                        <tr>
                            <td>Persones / Guests</td>
                            <td>2</td>
                        </tr>
                        <tr>
                            <td>Camping</td>
                            <td>Not</td>
                        </tr>
                        <tr>
                            <td>Ecotaxa</td>
                            <td>0,50 €</td>
                        </tr>
                    </table>

                    <paper-spinner alt="Cargando el usuario..." active="[[cargando]]"></paper-spinner>

                    <div class="output">{{resp}}</div>

                    <div class="output">{{mensaje}}</div>


                    <boton responsive><input type="button" on-click="_submit" value="RESERVAR / BOOKING"></boton>

                    <iron-request id="xhr"></iron-request>

                    <iron-ajax
                            id="elajax"
                            url="http://refugibackoffice.mateu.io/servidor/confirmar"
                            handle-as="json"
                            loading="{{cargando}}"
                            method="POST"
                            content-type="application/json"
                            on-response="respuestaRecibida"
                            on-error="errorRecibido"
                    ></iron-ajax>

                </div>
            </form>


        </div>

    </template>

    <script>
        Polymer({
            is: 'my-view3',

            properties: {
                user: Object,
                data: {
                    type: Object,
                    notify: true,
                },
                cargando: Boolean,
                route: {
                    type: Object,
                    notify: true,
                },


            },

            errorRecibido: function (e, error) {
                console.log(error.request); //ese es el iron-request de la solicitud
                this.mensaje = 'Error en la solicitud, con código ' + error.request.status;
            },

            respuestaRecibida: function (e, request) {
                if (request.succeeded) {
                    this.mensaje = 'la solicitud se resolvió correctamente con código ' + request.status
                    this.data.paymentlink = request.xhr.response.paymentlink;
                    this.set('route.path', '/view4');
                } else {
                    this.mensaje = 'la solicitud nos ofreció resultados incorrectos, con código ' + request.status
                }
            },

            _submit: function (e) {
                //this.set('resp', 'Hola!!!!')  ;
                //this.set('resp', JSON.stringify(this.data))  ;
                //this.$.xhr.send({url: 'src/server.jsp', method: 'POST', body: this.data});
                if (this.$.form.validate()) {
                    this.$.elajax.body = this.data;
                    this.$.elajax.generateRequest();

                }
            },

        });
    </script>
</dom-module>
